@page "/analyzer"

@using Model;

<MudText Typo="Typo.h3">Log Analyzer</MudText>
<InputFile id="fileInput" OnChange="OnInputFileChange" hidden />
<MudButton HtmlTag="label" Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Filled.UploadFile" for="fileInput">Log laden</MudButton>

<MudTable Items="logs" Dense="true" Striped="true" Hover="true">
    <ToolBarContent>
        <MudText Typo="Typo.h6">Log entries (@logs.Count)</MudText>
        <MudToolBarSpacer />
        <MudTextField @bind-Value="searchString" Placeholder="Search" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
    </ToolBarContent>
    <HeaderContent>
        <MudTh>Row</MudTh>
        <MudTh>Severity</MudTh>
        <MudTh>Time Stamp</MudTh>
        <MudTh>Class</MudTh>
        <MudTh>Method</MudTh>
        <MudTh>Message</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Row">@context.Row</MudTd>
        <MudTd DataLabel="Severity">@context.LogKind</MudTd>
        <MudTd DataLabel="TimeStamp">@context.TimeStamp</MudTd>
        <MudTd DataLabel="Class"><div style="overflow-wrap: anywhere;">@context.Class</div></MudTd>
        <MudTd DataLabel="Method"><div style="overflow-wrap: anywhere;">@context.Method</div></MudTd>
        <MudTd DataLabel="Message"><div style="overflow-wrap: anywhere; white-space:pre-wrap;">@context.Message</div></MudTd>
    </RowTemplate>
    <PagerContent>
        <MudTablePager />
    </PagerContent>
</MudTable>

@code {
    private string searchString = "";
    private IReadOnlyList<IBrowserFile> selectedFiles = new List<IBrowserFile>();
    private IReadOnlyList<LogEntry> logs = new List<LogEntry>();

    private async Task OnInputFileChange(InputFileChangeEventArgs e)
    {
        var selectedFile = e.GetMultipleFiles().Single();
        logs = await LogReader.ReadLogs(selectedFile);
        StateHasChanged();
    }
}
